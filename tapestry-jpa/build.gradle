plugins {
    id 'tapestry.testng-convention'
}

description = 'Provides support for simple CRUD applications built on top of Tapestry and JPA'

def moduleLibs = [
    jpaSpecs: 'org.apache.geronimo.specs:geronimo-jpa_2.0_spec:1.1',
    javaxCdiApi: 'javax.enterprise:cdi-api:1.2',
    eclipselink: 'org.eclipse.persistence:eclipselink:2.7.7',
    dbcp: 'org.apache.tomcat:dbcp:6.0.32',
    h2: 'com.h2database:h2:1.3.175'
]

dependencies {
    implementation project(':tapestry-core')

    api libs.javax.persistence.api
    implementation moduleLibs.jpaSpecs
    implementation moduleLibs.javaxCdiApi

    testImplementation project(':tapestry-test')
    testImplementation moduleLibs.eclipselink

    testRuntimeOnly moduleLibs.dbcp
    testRuntimeOnly moduleLibs.h2
}

(1..6).each {
    tasks.register("runTestApp${it}", JavaExec) {
        description = "Start app${it} integration test app, useful when debugging failing integration tests"
        mainClass = 'org.apache.tapestry5.test.JettyRunner'
        args '-d', "src/test/app${it}", '-p', '8080'
        classpath = project.sourceSets.test.runtimeClasspath
    }
}

tasks.named('jar', Jar) {
    manifest {
        attributes 'Tapestry-Module-Classes': 'org.apache.tapestry5.jpa.modules.JpaModule'
    }
}
